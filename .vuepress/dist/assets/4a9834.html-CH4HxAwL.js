import{_ as o,c as l,a as s,b as a,d as p,e,o as i,r as c}from"./app-DVyU65El.js";const u={},r={href:"https://github.com/Shanyaliux/ComposeDemo",target:"_blank",rel:"noopener noreferrer"},k={href:"https://github.com/Shanyaliux/ComposeDemo/tree/master/app/src/main/java/cn/shanyaliux/composedemo/permission",target:"_blank",rel:"noopener noreferrer"},d={href:"https://icode.best/i/68552745363490",target:"_blank",rel:"noopener noreferrer"};function v(m,n){const t=c("ExternalLinkIcon");return i(),l("div",null,[n[5]||(n[5]=s("p",null,"在Compose中以往的权限请求方式就不再适用了。因此我在使用过程中发现了一种非常简单优雅的权限申请方法。",-1)),s("p",null,[n[1]||(n[1]=a("全部代码见Github ")),s("a",r,[n[0]||(n[0]=a("Shanyaliux/ComposeDemo (github.com)")),p(t)])]),n[6]||(n[6]=e(`<h2 id="实现" tabindex="-1"><a class="header-anchor" href="#实现"><span><strong>实现</strong></span></a></h2><h3 id="权限请求" tabindex="-1"><a class="header-anchor" href="#权限请求"><span><strong>权限请求</strong></span></a></h3><ul><li><p>在<code>Activity</code>中添加一下请求方法</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">requestPermissions</span><span class="token punctuation">(</span>permissions<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span> onResult<span class="token operator">:</span> <span class="token punctuation">(</span>List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestMultiplePermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> result <span class="token operator">-&gt;</span></span>
<span class="line">            <span class="token keyword">val</span> failed <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">.</span>keys</span>
<span class="line">            <span class="token function">onResult</span><span class="token punctuation">(</span>failed<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>请求权限，改写<code>onCreate</code>的部分代码如下</p><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">val</span> requestList <span class="token operator">=</span></span>
<span class="line">            <span class="token function">arrayOf</span><span class="token punctuation">(</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>ACCESS_FINE_LOCATION<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token function">requestPermissions</span><span class="token punctuation">(</span>requestList<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            setContent <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;已获取全部权限.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">RequestFailedDialog</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 8v4"></path><path d="M12 16h.01"></path></g></svg><p class="custom-container-title">注意</p><p>别忘了在Manifest文件中先声明权限</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot;/&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></div></li></ul><h3 id="请求失败对话框提示-可选" tabindex="-1"><a class="header-anchor" href="#请求失败对话框提示-可选"><span><strong>请求失败对话框提示（可选）</strong></span></a></h3><div class="language-kotlin line-numbers-mode" data-highlighter="prismjs" data-ext="kt" data-title="kt"><pre><code><span class="line"><span class="token annotation builtin">@Composable</span></span>
<span class="line"><span class="token keyword">fun</span> <span class="token function">RequestFailedDialog</span><span class="token punctuation">(</span>permissions<span class="token operator">:</span> List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">val</span> activity <span class="token operator">=</span> LocalContext<span class="token punctuation">.</span>current <span class="token keyword">as</span><span class="token operator">?</span> Activity</span>
<span class="line">    <span class="token function">AlertDialog</span><span class="token punctuation">(</span>onDismissRequest <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        buttons <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            Row <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">Button</span><span class="token punctuation">(</span></span>
<span class="line">                    onClick <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                        activity<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token number">1f</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span>bottomStart <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    colors <span class="token operator">=</span> ButtonDefaults<span class="token punctuation">.</span><span class="token function">buttonColors</span><span class="token punctuation">(</span>backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;取消&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token function">Button</span><span class="token punctuation">(</span></span>
<span class="line">                    onClick <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">val</span> intent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>FLAG_ACTIVITY_NEW_TASK<span class="token punctuation">)</span></span>
<span class="line">                        intent<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;android.settings.APPLICATION_DETAILS_SETTINGS&quot;</span></span></span>
<span class="line">                        intent<span class="token punctuation">.</span>data <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">fromParts</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;package&quot;</span></span><span class="token punctuation">,</span> activity<span class="token operator">?</span><span class="token punctuation">.</span>packageName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="line">                        activity<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                    modifier <span class="token operator">=</span> Modifier<span class="token punctuation">.</span><span class="token function">weight</span><span class="token punctuation">(</span><span class="token number">1f</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span>bottomEnd <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                    colors <span class="token operator">=</span> ButtonDefaults<span class="token punctuation">.</span><span class="token function">buttonColors</span><span class="token punctuation">(</span>backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;确定&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        title <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;提示&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        text <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            Surface <span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">LazyColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token function">items</span><span class="token punctuation">(</span>permissions<span class="token punctuation">)</span> <span class="token punctuation">{</span> permission <span class="token operator">-&gt;</span></span>
<span class="line">                        <span class="token function">Text</span><span class="token punctuation">(</span>text <span class="token operator">=</span> permission<span class="token punctuation">)</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        shape <span class="token operator">=</span> <span class="token function">RoundedCornerShape</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">.</span>dp<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        backgroundColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>White<span class="token punctuation">,</span></span>
<span class="line">        contentColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>Black<span class="token punctuation">,</span></span>
<span class="line">        properties <span class="token operator">=</span> <span class="token function">DialogProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="demo" tabindex="-1"><a class="header-anchor" href="#demo"><span><strong>Demo</strong></span></a></h2>`,6)),s("p",null,[n[3]||(n[3]=a("完整Demo代码见GitHub：")),s("a",k,[n[2]||(n[2]=a("ComposeDemo/app/src/main/java/cn/shanyaliux/composedemo/permission at master · Shanyaliux/ComposeDemo (github.com)")),p(t)])]),n[7]||(n[7]=e('<h2 id="截图" tabindex="-1"><a class="header-anchor" href="#截图"><span><strong>截图</strong></span></a></h2><p><img src="https://cdn.jsdelivr.net/gh/ghlcode/PicBed/img/image-20220812224844049.png" alt="https://cdn.jsdelivr.net/gh/Shanyaliux/PicBed/img/image-20220812224844049.png"></p><p><img src="https://cdn.jsdelivr.net/gh/ghlcode/PicBed/img/image-20220812225142494.png" alt="https://cdn.jsdelivr.net/gh/Shanyaliux/PicBed/img/image-20220812225142494.png"></p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span><strong>参考</strong></span></a></h2>',4)),s("p",null,[s("a",d,[n[4]||(n[4]=a("https://icode.best/i/68552745363490")),p(t)])])])}const g=o(u,[["render",v],["__file","4a9834.html.vue"]]),h=JSON.parse('{"path":"/pages/4a9834.html","title":"Android Compose 权限请求","lang":"en-US","frontmatter":{"title":"Android Compose 权限请求","date":"2022/08/12","permalink":"/pages/4a9834.html","categories":["android"],"tags":["android"]},"headers":[{"level":2,"title":"实现","slug":"实现","link":"#实现","children":[{"level":3,"title":"权限请求","slug":"权限请求","link":"#权限请求","children":[]},{"level":3,"title":"请求失败对话框提示（可选）","slug":"请求失败对话框提示-可选","link":"#请求失败对话框提示-可选","children":[]}]},{"level":2,"title":"Demo","slug":"demo","link":"#demo","children":[]},{"level":2,"title":"截图","slug":"截图","link":"#截图","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"git":{"createdTime":1732191603000,"updatedTime":1732191603000,"contributors":[{"name":"Ghlerrix","email":"Ghlerrix@outlook.com","commits":1}]},"filePathRelative":"blogs/android/AndroidCompose权限请求.md"}');export{g as comp,h as data};
